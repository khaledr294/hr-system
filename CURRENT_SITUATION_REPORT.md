# ุชูุฑูุฑ ุญุงูุฉ ุงููุธุงู ูุงูุจูุงูุงุช ุงูุญุงููุฉ

**ุงูุชุงุฑูุฎ:** 15 ููููุจุฑ 2025  
**ุงููุฏู:** ุชุญููู ุงููุถุน ุงูุญุงูู ุจุนุฏ ุงูุชุนุฏููุงุช ุงูุฃุฎูุฑุฉ ุนูู ุงูุตูุงุญูุงุช ูุงูุฃูุงู

---

## ๐ ุงููุถุน ุงูุญุงูู

### 1. **ุญุงูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช**

#### **ุงููุดููุฉ ุงูุฑุฆูุณูุฉ:**
- Migration `20251115152000_permission_overhaul` ุงูุฐู ูุถูู:
  - `JobTitle.requiresTwoFactor` (ุนููุฏ ุฌุฏูุฏ)
  - `JobTitle.permissions` (ุชุญููู ูู JSON ุฅูู enum array)
  - ุญุฐู `User.role` (ุงูุขู ูุนุชูุฏ ุนูู JobTitle)
- **ูุฐุง Migration ูู ููุทุจูู ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุญุงููุฉ ูู Prisma Accelerate**
- ูุฐูู ุงูู seed script ููุดู ุนูุฏ ูุญุงููุฉ upsert JobTitles ูุฃู ุงูุนููุฏ `requiresTwoFactor` ุบูุฑ ููุฌูุฏ

#### **ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ ุญุงููุงู:**
- **ุงููุณุชุฎุฏููู ุงูุญูููููู:**
  - `nader@saed-hr.com`
  - `shimaa@saed-hr.com`
  - ูุณุชุฎุฏููู ุขุฎุฑูู ุชู ุฅูุดุงุคูู ูู ูุฑุญูุฉ ุงูุฅูุชุงุฌ
- **ูุคูุงุก ุงููุณุชุฎุฏููู ูุญููุธูู ูู ุงููุงุนุฏุฉ ุงูุญุงููุฉ ููู ูุถูุนูุง**

#### **ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ ุงููุทููุจ ุญุฐููุง:**
- `admin@hr-system.com`
- `hr@hr-system.com`
- ูุฐู ุงูุญุณุงุจุงุช ูุงูุช ููุชุฌุฑุจุฉ ููุท ููุฌุจ ุฅุฒุงูุฉ ูู ูุง ูุชุนูู ุจูุง ูู ุงูููุฏ

---

### 2. **Migrations ุงููุทููุจ ุชุทุจูููุง**

ุงููุฌูุฏ `prisma/migrations` ูุญุชูู ุนูู:

#### **Migrations ุงููุฏููุฉ (ูุทุจููุฉ):**
1. `20250915143954_saeddatabase`
2. `20250916065750_add_client_date_of_birth_field`
3. `20250916065947_add_notes_to_contract`
4. `20250916070501_add_package_model`
5. `20250916073906_add_log_table_and_user_relation`
6. `20250921004742_initial_schema_with_new_fields`
7. `20251109153713_add_notifications`
8. `20251109154616_add_backup_table`
9. `20251109164611_add_2fa_fields`
10. `20251109170606_add_archive_system`
11. `20251109220438_add_job_titles`
12. `20251111153641_change_marketer_to_user`
13. `20251111162221_change_worker_code_to_string`
14. `20251113120000_convert_date_columns`

#### **Migrations ุงูุฌุฏูุฏุฉ (ุบูุฑ ูุทุจููุฉ):**
- `20251115152000_permission_overhaul` โ **ูุฐุง ูู ุงููุดููุฉ ุงูุฃุณุงุณูุฉ**
- `20251115174334_permission_overhaul` โ ูุฌูุฏ ูุงุฑุบ (migration ูุงุดู)

---

### 3. **ุงูููุฏ ุงููุชุนูู ุจุงูุญุณุงุจุงุช ุงูุชุฌุฑูุจูุฉ**

ุชู ุงูุนุซูุฑ ุนูู ูุฑุงุฌุน ูู `admin@hr-system.com` ู `hr@hr-system.com` ูู:

#### **ูููุงุช Seeds & Scripts:**
- `prisma/seed.ts` (lines 160-175)
- `scripts/create-default-users.ts` (multiple locations)
- `scripts/test-databases.mjs`
- `scripts/db-guide.ps1`
- `scripts/database-identification.ps1`

#### **ูููุงุช API:**
- `src/app/api/setup/route.ts`
- `src/app/api/setup/create-users/route.ts`

#### **ูููุงุช UI:**
- `src/app/setup/page.tsx`
- `src/app/auth/login/page.tsx` (defaultValue="admin")

#### **ูููุงุช ุชูุซูู:**
- `LOGIN_CREDENTIALS.md`
- `SYSTEM_TEST_REPORT.md`
- `VERCEL_CONFLICTS_RESOLVED.md`
- `MANUAL_VERCEL_FIX.md`
- ููููุงุช ุชูุซูู ุฃุฎุฑู

---

## ๐ฏ ุฎุทุฉ ุงูุนูู ุงูููุตู ุจูุง

### **ุงููุฑุญูุฉ 1: ุงููุณุฎ ุงูุงุญุชูุงุทู (ุถุฑูุฑู ุฌุฏุงู)**
```powershell
# ุชุตุฏูุฑ ุงูุจูุงูุงุช ุงูุญุงููุฉ ูุจู ุฃู ุชุนุฏูู
npx prisma db pull --force
```
ูุฐุง ุณูููุดุฆ schema ูุญุฏูุซ ูุนูุณ ุงููุถุน ุงูุญุงูู ูููุงุนุฏุฉ

### **ุงููุฑุญูุฉ 2: ุชุทุจูู Migration ุงูุฃูู**

#### **ุงูุฎูุงุฑ A (ุงูููุตู ุจู): ุฅูุดุงุก migration ุชุฏุฑูุฌู**
ุจุฏูุงู ูู ุชุทุจูู `20251115152000_permission_overhaul` ูุจุงุดุฑุฉูุ ูููููุง:
1. ุฅูุดุงุก migration ูุชุญูู ูู ูุฌูุฏ ุงูุฃุนูุฏุฉ ุฃููุงู
2. ูุญุงูุธ ุนูู ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ
3. ูุถูู ุงูุตูุงุญูุงุช ุชุฏุฑูุฌูุงู

#### **ุงูุฎูุงุฑ B: ุชุทุจูู ูุจุงุดุฑ ูุน ุฎุทุฑ ุฃูู**
```powershell
# ุชุทุจูู ุงููุฑุญูุฉ ุงูุฃููู ููุท ูู migration
npx prisma migrate deploy
```
**ููุงุญุธุฉ ูููุฉ:** Migration `20251115152000` ูุญุฐู ุนููุฏ `User.role` - ูุฌุจ ุงูุชุฃูุฏ ุฃู ูู ุงููุณุชุฎุฏููู ูุฏููู `jobTitleId` ูุจู ุงูุชุทุจูู

### **ุงููุฑุญูุฉ 3: ุญุฐู ุงูุญุณุงุจุงุช ุงูุชุฌุฑูุจูุฉ**

#### **ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:**
```sql
-- ุญุฐู ุงูุญุณุงุจุงุช ุงูุชุฌุฑูุจูุฉ ููุท
DELETE FROM "User" WHERE email IN ('admin@hr-system.com', 'hr@hr-system.com');
```

#### **ูู ุงูููุฏ:**
ุณูููู ุจู:
1. ุญุฐู references ูู `prisma/seed.ts`
2. ุญุฐู `scripts/create-default-users.ts` ุฃู ุชุนุฏููู ูููุณุชุฎุฏููู ุงูุญูููููู
3. ุญุฐู `/api/setup` routes (ุบูุฑ ูุทููุจุฉ ูู ุงูุฅูุชุงุฌ)
4. ุชูุธูู ุตูุญุฉ `/setup`
5. ุฅุฒุงูุฉ default values ูู `/auth/login`
6. ุชุญุฏูุซ ูููุงุช ุงูุชูุซูู

### **ุงููุฑุญูุฉ 4: ุงูุชุญูู**
1. ุงุฎุชุจุงุฑ ุชุณุฌูู ุงูุฏุฎูู ุจู `nader@saed-hr.com`
2. ุงูุชุฃูุฏ ูู ุงูุตูุงุญูุงุช ุชุนูู ุจุดูู ุตุญูุญ
3. ุงุฎุชุจุงุฑ ุฅูุดุงุก ูุณุชุฎุฏููู ุฌุฏุฏ

---

## โ๏ธ ูุฎุงุทุฑ ูุฌุจ ุงูุงูุชุจุงู ููุง

### **ุฎุทุฑ ุนุงูู:**
1. **ููุฏุงู ุตูุงุญูุงุช ุงููุณุชุฎุฏููู ุงูุญุงูููู** ุฅุฐุง ูู ููู ูุฏููู `jobTitleId`
2. **ูุดู Migration** ุฅุฐุง ูุงู ููุงู constraints ุนูู `User.role`

### **ุฎุทุฑ ูุชูุณุท:**
3. Migration ูุฏ ูุฃุฎุฐ ููุช ุฅุฐุง ูุงู ุนุฏุฏ ุงูุณุฌูุงุช ูุจูุฑ
4. ูุฏ ุชุญุชุงุฌ downtime ูุตูุฑ ูุชุทุจูู ุงูุชุนุฏููุงุช

### **ุงูุญู:**
- ูุจู ุงูุชุทุจููุ ูุชุญูู ูู:
```sql
-- ุชุญูู ุฃู ูู ุงููุณุชุฎุฏููู ูุฏููู job titles
SELECT COUNT(*) FROM "User" WHERE "jobTitleId" IS NULL;

-- ุฅุฐุง ูุงูุช ุงููุชูุฌุฉ > 0ุ ูุฌุจ ุชุนููู job titles ุฃููุงู
```

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ ุงูููุชุฑุญุฉ

### **ุฎุทูุฉ 1: ุชุฃููุฏ ุญุงูุฉ ุงููุณุชุฎุฏููู ุงูุญุงูููู**
ุฃุฎุจุฑูู:
1. ูู `nader@saed-hr.com` ู `shimaa@saed-hr.com` ูุฏููู `jobTitleId` ูุญุฏุฏุ
2. ูุง ูู ุงูุตูุงุญูุงุช ุงููุทููุจุฉ ููู ููููุ
3. ูู ููุงู ูุณุชุฎุฏููู ุขุฎุฑูู ูุฌุจ ุงูุญูุงุธ ุนููููุ

### **ุฎุทูุฉ 2: ุงุฎุชูุงุฑ ุงุณุชุฑุงุชูุฌูุฉ Migration**
ุจูุงุกู ุนูู ุฅุฌุงุจุชูุ ุณุฃูุชุฑุญ:
- ุฅูุง migration ุขูู ุชุฏุฑูุฌู
- ุฃู script SQL ูุฏูู ููุชุญูู ูุงูุชุทุจูู

### **ุฎุทูุฉ 3: ุชูููุฐ ุงูุชูุธูู**
ุจุนุฏ ูุฌุงุญ Migrationุ ุณุฃููู ุจู:
1. ุญุฐู ูู references ููุญุณุงุจุงุช ุงูุชุฌุฑูุจูุฉ
2. ุชุญุฏูุซ ุงูู seed scripts ูููุณุชุฎุฏููู ุงูุญูููููู ููุท
3. ุฅุฒุงูุฉ ุตูุญุงุช ุงูุฅุนุฏุงุฏ ุบูุฑ ุงูุถุฑูุฑูุฉ

---

## ๐ ูุนูููุงุช ุฅุถุงููุฉ ูุทููุจุฉ

ูุฅููุงู ุงูุชุญูููุ ุฃุญุชุงุฌ ููู:

1. **ูู ููููู ุงููุตูู ููุงุนุฏุฉ ุงูุจูุงูุงุช ูุจุงุดุฑุฉูุ**
   - ุฅุฐุง ูุนูุ ุดุบูู ูุฐุง ุงูุงุณุชุนูุงู:
   ```sql
   SELECT email, "jobTitleId" FROM "User" 
   WHERE email LIKE '%saed-hr.com';
   ```

2. **ูุง ูู ุฏูุฑ ูู ูุณุชุฎุฏูุ**
   - nader โ ูุฏูุฑ ุงููุธุงูุ
   - shimaa โ ููุงุฑุฏ ุจุดุฑูุฉุ

3. **ูู ุชุฑูุฏ ุงูุงุญุชูุงุธ ุจุตูุญุฉ /setup ููุฅูุชุงุฌุ**
   - ุฃู ูุญุฐููุง ุชูุงูุงู ุจุนุฏ ุงูุชูุงุก ุงูุฅุนุฏุงุฏ ุงูุฃูููุ

---

**ููุฎุต:**
- ุงูุจูุงูุงุช ุงูุญุงููุฉ **ุขููุฉ** ููู ุชุถูุน
- ุงููุดููุฉ ูู Migration ุบูุฑ ูุทุจูู
- ูุญุชุงุฌ ุชุทุจูู Migration ุจุนูุงูุฉ ุซู ุญุฐู ุงูุญุณุงุจุงุช ุงูุชุฌุฑูุจูุฉ
- ุงูุญู ูุงุถุญ ูููู ูุญุชุงุฌ ุฎุทูุงุช ุฏูููุฉ ูุชุฌูุจ ููุฏุงู ุงูุจูุงูุงุช

ุฃุฎุจุฑูู ููู ุชุฑูุฏ ุงููุชุงุจุนุฉ ูุณุฃุจุฏุฃ ุจุชูููุฐ ุงูุญู ุงูููุงุณุจ! ๐
